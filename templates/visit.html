<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a2744">
    <meta name="format-detection" content="telephone=no">
    <title>Site Visit - Field App</title>
    <link rel="apple-touch-icon" href="/static/icon-192.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header compact">
            <a href="/" class="back-btn">â† Back</a>
            <h1 id="property-address">Loading...</h1>
        </header>

        <!-- Property Info Banner -->
                <!-- Offline Status -->
        <div id="offline-bar" class="offline-bar" style="display:none;">
            <span> Offline Mode</span>
            <span id="pending-sync">0 pending</span>
        </div>

        <div id="property-banner" class="property-banner">
            <div class="prop-row">
                <span class="prop-label">Client:</span>
                <span id="client-name">-</span>
            </div>
            <div class="prop-row">
                <span class="prop-label">Parcel:</span>
                <span id="parcel-id">-</span>
            </div>
            <div class="prop-row">
                <span class="prop-label">Acres:</span>
                <span id="acres">-</span>
            </div>
        </div>

        <!-- GPS Status Bar -->
        <div id="gps-status" class="gps-status">
            <span class="gps-icon">ðŸ“</span>
            <span id="gps-coords">Waiting for GPS...</span>
            <span id="gps-elevation" class="gps-elevation"></span>
            <span id="gps-accuracy" class="gps-accuracy"></span>
        </div>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn" data-tab="map">ðŸ—ºï¸ Map</button>
            <button class="tab-btn active" data-tab="checklist">âœ“ Checklist</button>
            <button class="tab-btn" data-tab="gps">ðŸ“ GPS</button>
            <button class="tab-btn" data-tab="photos">ðŸ“· Photos</button>
            <button class="tab-btn" data-tab="notes">ðŸ“ Notes</button>
        </nav>

        <!-- Tab Content -->
        <main class="tab-content">
            
            <!-- MAP TAB -->
            <section id="tab-map" class="tab-panel">
                <div class="map-container">
                    <div id="site-map"></div>
                    <div class="map-controls">
                        <button class="btn btn-small" onclick="centerOnMe()">ðŸŽ¯ Center on Me</button>
                        <button class="btn btn-small btn-primary" onclick="dropPinAtLocation()">ðŸ“ Drop Pin Here</button>
                        <button class="btn btn-small" onclick="toggleParcel()">ðŸ—ºï¸ Toggle Parcel</button>
                    </div>
                    <div class="map-legend">
                        <span class="legend-item"><span class="legend-dot you"></span> You</span>
                        <span class="legend-item"><span class="legend-line parcel"></span> Parcel</span>
                        <span class="legend-item"><span class="legend-line setback"></span> 10' Setback</span>
                    </div>
                    <div class="map-legend">
                        <span class="legend-item"><span class="legend-circle well"></span> ðŸ’§100'</span>
                        <span class="legend-item"><span class="legend-circle house"></span> ðŸ 50'</span>
                        <span class="legend-item"><span class="legend-circle sta"></span> ðŸš½10'</span>
                    </div>
                </div>
            </section>

            <!-- CHECKLIST TAB -->
            <section id="tab-checklist" class="tab-panel active">
                
                <!-- Arrival Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('arrival')">
                        <span>1ï¸âƒ£ Arrival</span>
                        <span class="section-status" id="status-arrival">0/6</span>
                    </div>
                    <div class="section-body" id="section-arrival">
                        <label class="check-item">
                            <input type="checkbox" data-section="arrival" data-item="time">
                            <span>Note arrival time</span>
                        </label>
                        <div class="form-inline">
                            <input type="time" id="arrival-time" placeholder="Time">
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="arrival" data-item="weather">
                            <span>Weather conditions</span>
                        </label>
                        <div class="form-inline">
                            <select id="arrival-weather">
                                <option value="">Select weather</option>
                                <option value="clear">â˜€ï¸ Clear/Sunny</option>
                                <option value="cloudy">â˜ï¸ Cloudy</option>
                                <option value="overcast">ðŸŒ¥ï¸ Overcast</option>
                                <option value="rain">ðŸŒ§ï¸ Rain</option>
                                <option value="snow">â„ï¸ Snow</option>
                            </select>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="arrival" data-item="road_photo">
                            <span>Photo: Road approach</span>
                        </label>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="arrival" data-item="entry_found">
                            <span>Property entrance identified</span>
                        </label>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="arrival" data-item="power_direction">
                            <span>Power pole direction noted</span>
                        </label>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="arrival" data-item="cell_signal">
                            <span>Cell signal checked</span>
                        </label>
                        <div class="form-inline">
                            <select id="cell-signal">
                                <option value="">Signal strength</option>
                                <option value="good">ðŸ“¶ Good</option>
                                <option value="weak">ðŸ“¶ Weak</option>
                                <option value="none">âŒ None</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Access & Driveway Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('access')">
                        <span>2ï¸âƒ£ Access & Driveway</span>
                        <span class="section-status" id="status-access">0/8</span>
                    </div>
                    <div class="section-body collapsed" id="section-access">
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="gps_entry">
                            <span>ðŸ“ GPS: Driveway entry</span>
                        </label>
                        <button class="btn btn-small btn-gps" onclick="captureGPS('driveway_entry')">Capture GPS</button>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="road_surface">
                            <span>Road surface noted</span>
                        </label>
                        <div class="form-inline">
                            <select id="road-surface">
                                <option value="">Select surface</option>
                                <option value="paved">Paved</option>
                                <option value="gravel">Gravel</option>
                                <option value="dirt">Dirt</option>
                                <option value="4wd">4WD Required</option>
                            </select>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="culvert">
                            <span>Culvert needed?</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="culvert" data-value="yes">Yes</button>
                            <button class="btn-option" data-field="culvert" data-value="no">No</button>
                            <button class="btn-option" data-field="culvert" data-value="maybe">Maybe</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="driveway_length">
                            <span>Driveway length measured</span>
                        </label>
                        <div class="form-inline">
                            <input type="number" id="driveway-length" placeholder="Length (ft)">
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="driveway_grade">
                            <span>Driveway grade estimated</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="grade" data-value="0-5">0-5%</button>
                            <button class="btn-option" data-field="grade" data-value="5-10">5-10%</button>
                            <button class="btn-option" data-field="grade" data-value="10-15">10-15%</button>
                            <button class="btn-option" data-field="grade" data-value="15+">15%+</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="switchbacks">
                            <span>Switchbacks needed?</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="switchbacks" data-value="yes">Yes</button>
                            <button class="btn-option" data-field="switchbacks" data-value="no">No</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="photo_driveway">
                            <span>ðŸ“· Photos: Driveway route</span>
                        </label>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="access" data-item="trees_driveway">
                            <span>Trees to remove counted</span>
                        </label>
                        <div class="form-inline">
                            <input type="number" id="trees-driveway" placeholder="# of trees">
                        </div>
                    </div>
                </div>

                <!-- Property Corners Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('corners')">
                        <span>3ï¸âƒ£ Property Corners</span>
                        <span class="section-status" id="status-corners">0/4</span>
                    </div>
                    <div class="section-body collapsed" id="section-corners">
                        <label class="check-item">
                            <input type="checkbox" data-section="corners" data-item="corner_ne">
                            <span>ðŸ“ Corner NE</span>
                        </label>
                        <button class="btn btn-small btn-gps" onclick="captureGPS('corner_ne')">Capture GPS</button>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="pin_ne" data-value="found">Pin Found</button>
                            <button class="btn-option" data-field="pin_ne" data-value="not_found">Not Found</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="corners" data-item="corner_se">
                            <span>ðŸ“ Corner SE</span>
                        </label>
                        <button class="btn btn-small btn-gps" onclick="captureGPS('corner_se')">Capture GPS</button>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="pin_se" data-value="found">Pin Found</button>
                            <button class="btn-option" data-field="pin_se" data-value="not_found">Not Found</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="corners" data-item="corner_sw">
                            <span>ðŸ“ Corner SW</span>
                        </label>
                        <button class="btn btn-small btn-gps" onclick="captureGPS('corner_sw')">Capture GPS</button>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="pin_sw" data-value="found">Pin Found</button>
                            <button class="btn-option" data-field="pin_sw" data-value="not_found">Not Found</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="corners" data-item="corner_nw">
                            <span>ðŸ“ Corner NW</span>
                        </label>
                        <button class="btn btn-small btn-gps" onclick="captureGPS('corner_nw')">Capture GPS</button>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="pin_nw" data-value="found">Pin Found</button>
                            <button class="btn-option" data-field="pin_nw" data-value="not_found">Not Found</button>
                        </div>
                    </div>
                </div>

                <!-- Build Site Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('buildsite')">
                        <span>4ï¸âƒ£ Build Site</span>
                        <span class="section-status" id="status-buildsite">0/8</span>
                    </div>
                    <div class="section-body collapsed" id="section-buildsite">
                        <label class="check-item critical">
                            <input type="checkbox" data-section="buildsite" data-item="gps_house">
                            <span>ðŸ“ GPS: HOUSE LOCATION</span>
                        </label>
                        <button class="btn btn-large btn-gps" onclick="captureGPS('house_location')">ðŸ  Capture House GPS</button>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="buildsite" data-item="slope">
                            <span>Slope at build site</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="site_slope" data-value="flat">Flat</button>
                            <button class="btn-option" data-field="site_slope" data-value="gentle">Gentle</button>
                            <button class="btn-option" data-field="site_slope" data-value="moderate">Moderate</button>
                            <button class="btn-option" data-field="site_slope" data-value="steep">Steep</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="buildsite" data-item="aspect">
                            <span>Slope direction (aspect)</span>
                        </label>
                        <div class="form-inline btn-group wrap">
                            <button class="btn-option" data-field="aspect" data-value="N">N</button>
                            <button class="btn-option" data-field="aspect" data-value="NE">NE</button>
                            <button class="btn-option" data-field="aspect" data-value="E">E</button>
                            <button class="btn-option" data-field="aspect" data-value="SE">SE</button>
                            <button class="btn-option" data-field="aspect" data-value="S">S</button>
                            <button class="btn-option" data-field="aspect" data-value="SW">SW</button>
                            <button class="btn-option" data-field="aspect" data-value="W">W</button>
                            <button class="btn-option" data-field="aspect" data-value="NW">NW</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="buildsite" data-item="foundation">
                            <span>Foundation type</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="foundation" data-value="slab">Slab</button>
                            <button class="btn-option" data-field="foundation" data-value="crawl">Crawl</button>
                            <button class="btn-option" data-field="foundation" data-value="walkout">Walkout</button>
                            <button class="btn-option" data-field="foundation" data-value="piers">Piers</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="buildsite" data-item="views">
                            <span>Views documented</span>
                        </label>
                        <div class="form-inline">
                            <input type="text" id="views-desc" placeholder="Describe views">
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="buildsite" data-item="sun">
                            <span>Sun exposure</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="sun" data-value="full">Full Sun</button>
                            <button class="btn-option" data-field="sun" data-value="partial">Partial</button>
                            <button class="btn-option" data-field="sun" data-value="shade">Shade</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="buildsite" data-item="trees_pad">
                            <span>Trees to clear for pad</span>
                        </label>
                        <div class="form-inline">
                            <input type="number" id="trees-pad" placeholder="# of trees">
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="buildsite" data-item="photos_site">
                            <span>ðŸ“· Photos: Build site (4 directions)</span>
                        </label>
                    </div>
                </div>

                <!-- Septic Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('septic')">
                        <span>5ï¸âƒ£ Septic System</span>
                        <span class="section-status" id="status-septic">0/5</span>
                    </div>
                    <div class="section-body collapsed" id="section-septic">
                        <label class="check-item critical">
                            <input type="checkbox" data-section="septic" data-item="gps_tank">
                            <span>ðŸ“ GPS: SEPTIC TANK</span>
                        </label>
                        <button class="btn btn-large btn-gps" onclick="captureGPS('septic_tank')">ðŸš½ Capture Tank GPS</button>
                        
                        <label class="check-item critical">
                            <input type="checkbox" data-section="septic" data-item="gps_leach">
                            <span>ðŸ“ GPS: LEACH FIELD</span>
                        </label>
                        <button class="btn btn-large btn-gps" onclick="captureGPS('leach_field')">ðŸŒ¿ Capture Leach GPS</button>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="septic" data-item="pump_needed">
                            <span>Pump system needed?</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="pump" data-value="yes">Yes (uphill)</button>
                            <button class="btn-option" data-field="pump" data-value="no">No (gravity)</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="septic" data-item="soil_septic">
                            <span>Soil at septic area</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="septic_soil" data-value="sandy">Sandy</button>
                            <button class="btn-option" data-field="septic_soil" data-value="loam">Loam</button>
                            <button class="btn-option" data-field="septic_soil" data-value="clay">Clay</button>
                            <button class="btn-option" data-field="septic_soil" data-value="rocky">Rocky</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="septic" data-item="setback_ok">
                            <span>100'+ from well confirmed</span>
                        </label>
                    </div>
                </div>

                <!-- Soils Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('soils')">
                        <span>6ï¸âƒ£ Soils & Geology</span>
                        <span class="section-status" id="status-soils">0/5</span>
                    </div>
                    <div class="section-body collapsed" id="section-soils">
                        <label class="check-item critical">
                            <input type="checkbox" data-section="soils" data-item="gps_pit">
                            <span>ðŸ“ GPS: SOIL PIT LOCATION</span>
                        </label>
                        <button class="btn btn-large btn-gps" onclick="captureGPS('soil_pit')">ðŸ•³ï¸ Capture Pit GPS</button>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="soils" data-item="surface_soil">
                            <span>Surface soil type</span>
                        </label>
                        <div class="form-inline btn-group wrap">
                            <button class="btn-option" data-field="soil_type" data-value="topsoil">Topsoil</button>
                            <button class="btn-option" data-field="soil_type" data-value="sandy">Sandy</button>
                            <button class="btn-option" data-field="soil_type" data-value="clay">Clay</button>
                            <button class="btn-option" data-field="soil_type" data-value="dg">DG</button>
                            <button class="btn-option" data-field="soil_type" data-value="rocky">Rocky</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="soils" data-item="rock_outcrops">
                            <span>Rock outcrops</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="rock" data-value="none">None</button>
                            <button class="btn-option" data-field="rock" data-value="minor">Minor</button>
                            <button class="btn-option" data-field="rock" data-value="moderate">Moderate</button>
                            <button class="btn-option" data-field="rock" data-value="significant">Significant</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="soils" data-item="excavation">
                            <span>Excavation difficulty</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="excavation" data-value="easy">Easy</button>
                            <button class="btn-option" data-field="excavation" data-value="moderate">Moderate</button>
                            <button class="btn-option" data-field="excavation" data-value="difficult">Difficult</button>
                            <button class="btn-option" data-field="excavation" data-value="very_hard">Very Hard</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="soils" data-item="photos_rock">
                            <span>ðŸ“· Photos: Rock outcrops</span>
                        </label>
                    </div>
                </div>

                <!-- Well Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('well')">
                        <span>7ï¸âƒ£ Well</span>
                        <span class="section-status" id="status-well">0/3</span>
                    </div>
                    <div class="section-body collapsed" id="section-well">
                        <label class="check-item">
                            <input type="checkbox" data-section="well" data-item="existing">
                            <span>Existing well on property?</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="existing_well" data-value="yes">Yes</button>
                            <button class="btn-option" data-field="existing_well" data-value="no">No</button>
                        </div>
                        
                        <label class="check-item critical">
                            <input type="checkbox" data-section="well" data-item="gps_well">
                            <span>ðŸ“ GPS: WELL LOCATION</span>
                        </label>
                        <button class="btn btn-large btn-gps" onclick="captureGPS('well_location')">ðŸ’§ Capture Well GPS</button>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="well" data-item="neighbor_wells">
                            <span>Neighboring wells visible?</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="neighbor_wells" data-value="yes">Yes</button>
                            <button class="btn-option" data-field="neighbor_wells" data-value="no">No</button>
                        </div>
                    </div>
                </div>

                <!-- Utilities Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('utilities')">
                        <span>8ï¸âƒ£ Utilities</span>
                        <span class="section-status" id="status-utilities">0/4</span>
                    </div>
                    <div class="section-body collapsed" id="section-utilities">
                        <label class="check-item">
                            <input type="checkbox" data-section="utilities" data-item="gps_power">
                            <span>ðŸ“ GPS: Power pole/transformer</span>
                        </label>
                        <button class="btn btn-small btn-gps" onclick="captureGPS('power_pole')">âš¡ Capture GPS</button>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="utilities" data-item="power_distance">
                            <span>Distance to power</span>
                        </label>
                        <div class="form-inline">
                            <input type="number" id="power-distance" placeholder="Distance (ft)">
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="utilities" data-item="power_location">
                            <span>Power location</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="power_loc" data-value="on_property">On Property</button>
                            <button class="btn-option" data-field="power_loc" data-value="road">At Road</button>
                            <button class="btn-option" data-field="power_loc" data-value="far">Far Away</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="utilities" data-item="cell_signal">
                            <span>ðŸ“¶ Cell signal strength</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="cell_signal" data-value="none">âŒ None</button>
                            <button class="btn-option" data-field="cell_signal" data-value="weak">ðŸ“¶ Weak</button>
                            <button class="btn-option" data-field="cell_signal" data-value="good">ðŸ“¶ðŸ“¶ Good</button>
                            <button class="btn-option" data-field="cell_signal" data-value="strong">ðŸ“¶ðŸ“¶ðŸ“¶ Strong</button>
                        </div>
                        <div class="form-inline">
                            <input type="text" id="cell-carrier" placeholder="Carrier (AT&T, Verizon, etc.)">
                        </div>
                    </div>
                </div>

                <!-- Assessment Section -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('assessment')">
                        <span>âœ… Final Assessment</span>
                        <span class="section-status" id="status-assessment">0/4</span>
                    </div>
                    <div class="section-body collapsed" id="section-assessment">
                        <label class="check-item">
                            <input type="checkbox" data-section="assessment" data-item="complexity">
                            <span>Site Complexity</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="complexity" data-value="low">Low</button>
                            <button class="btn-option" data-field="complexity" data-value="moderate">Moderate</button>
                            <button class="btn-option" data-field="complexity" data-value="high">High</button>
                            <button class="btn-option" data-field="complexity" data-value="very_high">Very High</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="assessment" data-item="desktop_match">
                            <span>Desktop analysis accurate?</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="desktop" data-value="yes">Yes</button>
                            <button class="btn-option" data-field="desktop" data-value="minor">Minor Diff</button>
                            <button class="btn-option" data-field="desktop" data-value="major">Major Diff</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="assessment" data-item="buildable">
                            <span>Buildable?</span>
                        </label>
                        <div class="form-inline btn-group wrap">
                            <button class="btn-option" data-field="buildable" data-value="yes_easy">Yes - Easy</button>
                            <button class="btn-option" data-field="buildable" data-value="yes_challenges">Yes - Challenges</button>
                            <button class="btn-option" data-field="buildable" data-value="marginal">Marginal</button>
                            <button class="btn-option" data-field="buildable" data-value="no">Not Recommended</button>
                        </div>
                        
                        <label class="check-item">
                            <input type="checkbox" data-section="assessment" data-item="cost_adjust">
                            <span>Cost estimate adjustment</span>
                        </label>
                        <div class="form-inline btn-group">
                            <button class="btn-option" data-field="cost" data-value="lower">Lower</button>
                            <button class="btn-option" data-field="cost" data-value="about_right">About Right</button>
                            <button class="btn-option" data-field="cost" data-value="higher">Higher</button>
                        </div>
                    </div>
                </div>

            </section>

            <!-- GPS TAB -->
            <section id="tab-gps" class="tab-panel">
                <div class="gps-panel">
                    <h3>ðŸ“ GPS Points Captured</h3>
                    <div id="gps-points-list" class="gps-points-list">
                        <p class="empty-state">No GPS points captured yet</p>
                    </div>
                    
                    <div class="gps-actions">
                        <button class="btn btn-primary btn-large" onclick="captureGPS('custom')">
                            ðŸ“ Capture Current Location
                        </button>
                    </div>
                </div>
            </section>

            <!-- PHOTOS TAB -->
            <section id="tab-photos" class="tab-panel">
                <div class="photos-panel">
                    <h3>ðŸ“· Photos</h3>
                    
                    <div class="photo-capture">
                        <select id="photo-label">
                            <option value="road">Road Approach</option>
                            <option value="driveway_entry">Driveway Entry</option>
                            <option value="driveway_route">Driveway Route</option>
                            <option value="corner">Property Corner</option>
                            <option value="build_site">Build Site</option>
                            <option value="views">Views</option>
                            <option value="septic_area">Septic Area</option>
                            <option value="soil_pit">Soil Pit Location</option>
                            <option value="well">Well Location</option>
                            <option value="power">Power/Utilities</option>
                            <option value="rock">Rock Outcrops</option>
                            <option value="drainage">Drainage/Wet Areas</option>
                            <option value="problem">Problem Area</option>
                            <option value="other">Other</option>
                        </select>
                        <button class="btn btn-primary btn-large" onclick="capturePhoto()">
                            ðŸ“· Take Photo
                        </button>
                    </div>
                    
                    <div id="photos-list" class="photos-list">
                        <p class="empty-state">No photos captured yet</p>
                    </div>
                    
                    <!-- iOS camera capture -->
                    <input type="file" id="camera-input" accept="image/*" capture="environment" style="display:none">
                    <!-- Fallback for choosing from library -->
                    <input type="file" id="library-input" accept="image/*" style="display:none">
                </div>
            </section>

            <!-- NOTES TAB -->
            <section id="tab-notes" class="tab-panel">
                <div class="notes-panel">
                    <h3>ðŸ“ Notes & Observations</h3>
                    
                    <div class="notes-section">
                        <label>âš ï¸ Concerns / Red Flags</label>
                        <textarea id="notes-concerns" rows="4" placeholder="Any concerns or deal breakers..."></textarea>
                    </div>
                    
                    <div class="notes-section">
                        <label>ðŸ“‹ Key Findings</label>
                        <textarea id="notes-findings" rows="4" placeholder="Summary of key findings..."></textarea>
                    </div>
                    
                    <div class="notes-section">
                        <label>ðŸ’¡ Recommendations</label>
                        <textarea id="notes-recommendations" rows="4" placeholder="Recommendations for client..."></textarea>
                    </div>
                    
                    <button class="btn btn-primary" onclick="saveNotes()">ðŸ’¾ Save Notes</button>
                </div>
            </section>
        </main>

        <!-- Bottom Action Bar -->
        <footer class="action-bar">
            <button class="btn btn-secondary" onclick="saveProgress()">ðŸ’¾ Save</button>
            <button class="btn btn-primary" onclick="completeVisit()">âœ… Complete Visit</button>
        </footer>
    </div>

    <!-- GPS Capture Modal -->
    <div id="gps-modal" class="modal">
        <div class="modal-content">
            <h3>ðŸ“ Capture GPS Point</h3>
            <div id="gps-modal-status" class="gps-modal-status">
                Getting location...
            </div>
            <div class="form-group">
                <label>Point Label</label>
                <input type="text" id="gps-label" placeholder="e.g., House Location">
            </div>
            <div class="form-group">
                <label>Latitude</label>
                <input type="text" id="gps-lat" readonly>
            </div>
            <div class="form-group">
                <label>Longitude</label>
                <input type="text" id="gps-lon" readonly>
            </div>
            <div class="form-group">
                <label>â›°ï¸ Elevation (ft)</label>
                <input type="text" id="gps-elev" readonly>
            </div>
            <div class="form-group">
                <label>Accuracy</label>
                <input type="text" id="gps-acc" readonly>
            </div>
            <div class="button-row">
                <button class="btn btn-secondary" onclick="closeGPSModal()">Cancel</button>
                <button class="btn btn-primary" id="save-gps-btn" onclick="saveGPSPoint()">Save Point</button>
            </div>
        </div>
    </div>

    <script src="/static/js/offline.js"></script>
    <script src="/static/js/visit.js"></script>
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('SW registered'))
                .catch(err => console.log('SW error:', err));
        }
    </script>
    <script>
        // Initialize with project ID from URL
        initVisit('{{ project_id }}');
    </script>
</body>
</html>



